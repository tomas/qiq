var qiq2=function(){function i(e,t){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var i in n)e[i]?console.warn("Cannot overwrite "+i+" property"):e[i]=n[i]}return e}var t=/[&<>"']/,h=/[?!#@_\/]/,n={"==":function(e,t){return e===t},"!=":function(e,t){return e!==t},"<":function(e,t){return Number(e)<Number(t)},"<=":function(e,t){return Number(e)<=Number(t)},">":function(e,t){return Number(e)>Number(t)},">=":function(e,t){return Number(e)>=Number(t)}},u={h:function(e){return e&&e.replace&&t.test(e)?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):e},decode:decodeURIComponent,encode:encodeURIComponent,upper:function(e){return e.toUpperCase()},lower:function(e){return e.toLowerCase()},slug:function(e){return e.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/ /g,"-")}},a={c:function(e,t,r){return n[e](t,r)},a:function(e){return Array.isArray(e)?0===e.length?null:e:e?[e]:null},b:function(e){return!(!e||0==e.length)},v:function(e,t,r,n){return"function"==typeof e?e.call(n,t,r):e},d:function(e,t,r,n){return"function"==typeof e?e.call(n,t,r):null==e?"":e}};function r(c,o){o=o||{};var l=[],a=l,s=[];function f(e){o.trim&&(e=(e=e.replace(/[\r\n]+\s*/g,"")).replace(/\\/g,"\\\\")),e=e.replace(/'/g,"\\'");var t=a.length-1,r=a[t];"string"!=typeof r?a.push(e):a[t]=r+e}function p(e){a.push(e)}function g(e){e.buf=[],e.cur=e.buf,a=e.buf,s.push(e)}function d(){return s[s.length-1]}function x(e){var t,r,n={type:e[0],tag:e};if(h.test(n.type))n.tag=e.substring(1).split(/ |\?/)[0];else{if(0<=e.indexOf("(")||0<=e.indexOf(";"))return void console.warn("invalid tag:",e);if("?"!=e.slice(-1))return s.length||"."!=e[0]||(n.tag=e.slice(1)),n.type="r",function(e,t){var r=new RegExp("([ ]*\\|[ ]*\\w+)+","g").exec(e);if(r){t.tag=e.substring(0,r.index);var n=r[0].replace(/ /g,"").substring(1).split("|"),i=n.indexOf("raw");-1<i?n.splice(i,1):n.push("h"),t.f=n}else t.f=["h"]}(e,n),p(n),1;n.type="?",n.tag=e.slice(0,-1)}switch(s.length||"."!=n.tag[0]||(n.tag=n.tag.slice(1)),n.type){case"?":case"!":case"#":p(n),g(n);break;case"@":var i=e.match(/if (.+)\s?(==|!=|<|>|<=|>=?)\s?(.+)/);if(!i)return;n.method=i[2],n.params={key:i[1].trim(),value:i[3].trim()},p(n),g(n);break;case"_":!function(e){var t=d();if(!t)throw new Error("no block, cannot add body");if("else"!=(e=e||"else"))throw new Error("invalid tag: _"+e+", should be _else");t.bods=t.bods||{},t.bods[e]=[],a=t.cur=t.bods[e]}(n.tag);break;case"/":var u=(t=s.pop(),r=d(),a=r&&r.cur||l,t);u?n.tag&&u.tag!==n.tag&&console.warn("tag mismatch",u.tag,n.tag):console.warn("extra closing /")}return 1}return function(){c=o.trim?c.replace(/^\s+/g,""):c.replace(/\r/g,"\\r").replace(/\n/g,"\\n");for(var e,t,r=(o||{}).delimiters||["{{","}}"],n=new RegExp("(.*?)\\"+r[0]+"\\s*","msg"),i=new RegExp("(.*?)\\"+r[1],"msg"),u=0;null!==(e=n.exec(c));){e[1]&&f(e[1]),u=e.index+e[0].length;var a="";for(i.lastIndex=u;null!==(t=i.exec(c))&&(a+=t[1],-1!==t[1].lastIndexOf(r[0]));)a+=r[1];if(!t)throw new Error("No "+r[1]+"at idx",u);u=t.index+t[0].length,n.lastIndex=u,x(a.trim())||f("{"+a+"}")}if(0<s.length)throw new Error("Missing closing tag for",s[0].type,s[0].tag);return u<c.length&&f(c.slice(u)),l}()}function c(e){var u=0,a="var r='',l=l||{},c=c||{ctx:[]};var a=s?function(x){s.write(String(x))}:function(x){r+=x};";function c(e){e.forEach(function(e){if("r"===e.type)a+="a("+(i=p((n=e).tag,"u.d"),n.f&&n.f.forEach(function(e){i="u.f."+e+"("+i+",l,c)"}),i)+");";else if("?"===e.type||"!"===e.type){var t="!"===e.type?"!":"";l(),a+="if("+t+"u.b("+p(e.tag)+")){",c(e.buf),a+="}",o(e),s()}else if("#"===e.type){u++,l(!0),a+="var a"+(r=u)+"=u.a("+p(e.tag)+");",a+="if(a"+r+"){",e.buf?(a+="l._up="+f(e.tag).pop().replace(/\.[^.]+$/,"")+";",a+="l.$len=a"+r+".length;",a+="for(var i"+r+"=0;i"+r+"<a"+r+".length;i"+r+"++){",a+="l._it=a"+r+"[i"+r+"];",a+="l.$idx=i"+r+";",c(e.buf),a+="}"):a+="a(a"+r+")",a+="}",o(e),s(!0)}else if("@"===e.type){var r;a+="var h"+(r=++u)+"=u.c('"+e.method+"',"+p(e.params.key)+","+e.params.value+",l);",a+="if(h"+r+"){",e.buf?c(e.buf):a+="a(h"+r+");",a+="}",o(e)}else e.type||(a+="a('"+e+"');");var n,i})}function o(e){e.bods&&e.bods.else&&(a+="else{",c(e.bods.else),a+="}")}function l(e){a+="var ctx"+u+"={};",e&&(a+="ctx"+u+"._it=l._it;",a+="ctx"+u+"._up=l._up;",a+="ctx"+u+".idx=l.$idx;",a+="ctx"+u+".length=l.$len;"),a+="c.ctx.push(ctx"+u+");"}function s(e){a+="var p_ctx"+u+"=c.ctx.pop();",e&&(a+="l._it=p_ctx"+u+"._it;",a+="l._up=p_ctx"+u+"._up;",a+="l.$idx=p_ctx"+u+".idx;",a+="l.$len=p_ctx"+u+".length;")}function f(e){if(!isNaN(e))return e;if("'"==e[0]||'"'==e[0])return[e];"."===e[0]&&(e="_it"+e);var t,r,n=[],i=!1,u=0;for(t=0;t<e.length;t=1+t)r=e[t],i||"."!==r&&"["!==r?"]"===r&&(n.push("["+p(e.substring(u,t))+"]"),i=!1,u=t+1):(u<t&&n.push(e.substring(u,t)),u=t+1,i="["===r);u<t&&n.push(e.substring(u,t));var a="l",c=[];return n.forEach(function(e){"["===e[0]?a+=e:a+="."+e,c.push(a)}),c}function p(e,t){if(t=t||"u.v","."===e.trim())return"l._it";if("."==e[0]&&"."==e[1])return t+"("+("l._up."+e.substring(2))+",l._up,l,c)";var r=f(e);if(1===r.length)return t+"("+r[0]+",l._it,l,c)";var n=r.slice(0,-1);return t+"("+r.join("&&")+","+n.join("&&")+",l,c)"}return c(e),new Function("l","u","c","s",a+"return r;")}return{setup:function(e){e&&e.filters&&i(u,e.filters)},compile:function(e,t){return c(r(e,t))},render:function(e,t,r,n){return a.f=r&&r.filters?i({},u,r.filters):u,e(t,a,r&&r.context,n)}}}();"undefined"!=typeof module&&module.exports&&(exports=module.exports=qiq2.render,exports.compile=qiq2.compile,exports.setup=qiq2.setup);
