var qiq2=function(){function u(e,t){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var u in n)e[u]?console.warn("Cannot overwrite "+u+" property"):e[u]=n[u]}return e}var t=/[&<>"']/,h=/[?!#@_\/]/,n={"==":function(e,t){return e===t},"!=":function(e,t){return e!==t},"<":function(e,t){return Number(e)<Number(t)},"<=":function(e,t){return Number(e)<=Number(t)},">":function(e,t){return Number(e)>Number(t)},">=":function(e,t){return Number(e)>=Number(t)}},i={h:function(e){return e&&e.replace&&t.test(e)?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):e},decode:decodeURIComponent,encode:encodeURIComponent,upper:function(e){return e.toUpperCase()},lower:function(e){return e.toLowerCase()},slug:function(e){return e.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/ /g,"-")}},o={c:function(e,t,r){return n[e](t,r)},a:function(e){return Array.isArray(e)?0===e.length?null:e:e?[e]:null},b:function(e){return!(!e||0==e.length)},v:function(e,t,r,n){return"function"==typeof e?e.call(n,t,r):e},d:function(e,t,r,n){return"function"==typeof e?e.call(n,t,r):null==e?"":e}};function r(c,a){a=a||{};var l=[],o=l,s=[];function f(e){a.htmltrim&&(e=(e=e.replace(/[\r\n]+\s*/g,"")).replace(/\\/g,"\\\\")),e=e.replace(/'/g,"\\'");var t=o.length-1,r=o[t];"string"!=typeof r?o.push(e):o[t]=r+e}function p(e){o.push(e)}function g(e){e.buf=[],e.cur=e.buf,o=e.buf,s.push(e)}function d(){return s[s.length-1]}function x(e){var t,r,n={type:e[0],tag:e};if(h.test(n.type))n.tag=e.substring(1).split(/ |\?/)[0];else{if(0<=e.indexOf("(")||0<=e.indexOf(";"))return void console.warn("invalid tag:",e);if("?"!=e.slice(-1))return n.type="r",function(e,t){var r=new RegExp("([ ]*\\|[ ]*\\w+)+","g").exec(e);if(r){t.tag=e.substring(0,r.index);var n=r[0].replace(/ /g,"").substring(1).split("|"),u=n.indexOf("raw");-1<u?n.splice(u,1):n.push("h"),t.f=n}else t.f=["h"]}(e,n),p(n),1;n.type="?",n.tag=e.slice(0,-1)}switch(n.type){case"?":case"!":case"#":p(n),g(n);break;case"@":var u=e.match(/if (.+)\s?(==|!=|<|>|<=|>=?)\s?(.+)/);if(!u)return;n.method=u[2],n.params={key:u[1].trim(),value:u[3].trim()},p(n),g(n);break;case"_":!function(e){var t=d();if(!t)throw new Error("no block, cannot add body");if("else"!=(e=e||"else"))throw new Error("invalid tag: _"+e+", should be _else");t.bods=t.bods||{},t.bods[e]=[],o=t.cur=t.bods[e]}(n.tag);break;case"/":var i=(t=s.pop(),r=d(),o=r&&r.cur||l,t);i?n.tag&&i.tag!==n.tag&&console.warn("tag mismatch",i.tag,n.tag):console.warn("extra closing /")}return 1}return function(){c=a.htmltrim?c.replace(/^\s+/g,""):c.replace(/\r/g,"\\r").replace(/\n/g,"\\n");for(var e,t,r=(a||{}).delimiters||["{{","}}"],n=new RegExp("(.*?)\\"+r[0]+"\\s*","msg"),u=new RegExp("(.*?)\\"+r[1],"msg"),i=0;null!==(e=n.exec(c));){e[1]&&f(e[1]),i=e.index+e[0].length;var o="";for(u.lastIndex=i;null!==(t=u.exec(c))&&(o+=t[1],-1!==t[1].lastIndexOf(r[0]));)o+=r[1];if(!t)throw new Error("No "+r[1]+"at idx",i);i=t.index+t[0].length,n.lastIndex=i,x(o.trim())||f("{"+o+"}")}if(0<s.length)throw new Error("Missing closing tag for",s[0].type,s[0].tag);return i<c.length&&f(c.slice(i)),l}()}function c(e){var i=0,o="var r='',l=l||{},c=c||{ctx:[]};var a=s?function(x){s.write(String(x))}:function(x){r+=x};";function c(e){e.forEach(function(e){if("r"===e.type)o+="a("+(u=p((n=e).tag,"u.d"),n.f&&n.f.forEach(function(e){u="u.f."+e+"("+u+",l,c)"}),u)+");";else if("?"===e.type||"!"===e.type){var t="!"===e.type?"!":"";l(),o+="if("+t+"u.b("+p(e.tag)+")){",c(e.buf),o+="}",a(e),s()}else if("#"===e.type){i++,l(!0),o+="var a"+(r=i)+"=u.a("+p(e.tag)+");",o+="if(a"+r+"){",e.buf?(o+="l._up="+f(e.tag).pop().replace(/\.[^.]+$/,"")+";",o+="l.$len=a"+r+".length;",o+="for(var i"+r+"=0;i"+r+"<a"+r+".length;i"+r+"++){",o+="l._it=a"+r+"[i"+r+"];",o+="l.$idx=i"+r+";",c(e.buf),o+="}"):o+="a(a"+r+")",o+="}",a(e),s(!0)}else if("@"===e.type){var r;o+="var h"+(r=++i)+"=u.c('"+e.method+"',"+p(e.params.key)+","+e.params.value+",l);",o+="if(h"+r+"){",e.buf?c(e.buf):o+="a(h"+r+");",o+="}",a(e)}else e.type||(o+="a('"+e+"');");var n,u})}function a(e){e.bods&&e.bods.else&&(o+="else{",c(e.bods.else),o+="}")}function l(e){o+="var ctx"+i+"={};",e&&(o+="ctx"+i+"._it=l._it;",o+="ctx"+i+"._up=l._up;",o+="ctx"+i+".idx=l.$idx;",o+="ctx"+i+".length=l.$len;"),o+="c.ctx.push(ctx"+i+");"}function s(e){o+="var p_ctx"+i+"=c.ctx.pop();",e&&(o+="l._it=p_ctx"+i+"._it;",o+="l._up=p_ctx"+i+"._up;",o+="l.$idx=p_ctx"+i+".idx;",o+="l.$len=p_ctx"+i+".length;")}function f(e){if(!isNaN(e))return e;if("'"==e[0]||'"'==e[0])return[e];"."===e[0]&&(e="_it"+e);var t,r,n=[],u=!1,i=0;for(t=0;t<e.length;t=1+t)r=e[t],u||"."!==r&&"["!==r?"]"===r&&(n.push("["+p(e.substring(i,t))+"]"),u=!1,i=t+1):(i<t&&n.push(e.substring(i,t)),i=t+1,u="["===r);i<t&&n.push(e.substring(i,t));var o="l",c=[];return n.forEach(function(e){"["===e[0]?o+=e:o+="."+e,c.push(o)}),c}function p(e,t){if(t=t||"u.v","."===e.trim())return"l._it";if("."==e[0]&&"."==e[1])return t+"("+("l._up."+e.substring(2))+",l._up,l,c)";var r=f(e);if(1===r.length)return t+"("+r[0]+",l._it,l,c)";var n=r.slice(0,-1);return t+"("+r.join("&&")+","+n.join("&&")+",l,c)"}return c(e),new Function("l","u","c","s",o+"return r;")}return{setup:function(e){e&&e.filters&&u(i,e.filters)},compile:function(e,t){return c(r(e,t))},render:function(e,t,r,n){return o.f=r&&r.filters?u({},i,r.filters):i,e(t,o,r&&r.context,n)}}}();"undefined"!=typeof module&&module.exports&&(exports=module.exports=qiq2.render,exports.compile=qiq2.compile,exports.setup=qiq2.setup);
