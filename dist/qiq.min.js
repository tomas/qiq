var qiq=function(){var i={},d=/\{\{ ?| ?\}\}/;function k(e){return e.name||(e.toString().match(/function (.+?)\(/)||[,""])[1]}function v(e,t){var n=e,r=t.split(".");for(var i in r){if(!n[t=r[i]])return;n=n[t]}return n}function w(e,t,n,r){var i=e.constructor==Object&&-1<t.indexOf(".")?v(e,t):e[t];if(4==n)return!(w.last=i)||void 0!==i.length&&!i.length?"":r(e);if((2==n||3==n)&&w.last&&(!Array.isArray(w.last)||w.last.length))return w.last=null,"";if(Array.isArray(i))return n%3==0?i.length?"":r(e):1==n?i.map(r).join(""):r(i);if(1==n&&i&&i.constructor===Object)return r(i);if("function"==typeof i){if("boolean"!=typeof(i=i.call(e,r(e))))return i;i||2!==n||(i=!i)}return n%3==0&&(i=!i),(w.last=i)?r(e):""}function x(e){return String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function o(e,t){t=t||{};for(var n,r,i,o,s,u,l=[],c={},a=[],p=e.split(t.delimiter||d),f=t.escapeNewLines?"\\\\\\n":"\\n",g=t.globals,h=k(x),b=k(w),m=0;m<p.length;++m)if(r=p[m],m%2==0)l.push('"'+r.replace(/"/g,'\\"')+'"');else switch(r[0]){case"/":r=r.slice(1);var y=a[a.length-1];if(""==r)r=y;else if(r!=y)continue;l.push("})+"),a.pop(),delete c[r];break;case"!":r=r.slice(1),i=0,a.push(r),"?"==r.slice(-1)&&(i=6,r=r.slice(0,-1)),q(r),S(c[r]),c[r]=i,l.push("+"+b+'(o,"'+r+'",'+i+",function(o){return ");break;case"?":r=r.slice(1),i=4,a.push(r),S(r,c[r]),c[r]=i,n="o","."==r[0]&&(n="it",r=r.substring(1)),l.push("+"+b+"("+n+',"'+r+'",'+i+",function(o){return ");break;case"_":""!=(r=r.slice(1))&&"else"!=r||(r=a[a.length-1]),i=c[r]+2,n="o","."==r[0]&&(n="it",r=r.substring(1)),l.push("})+"+b+"("+n+',"'+r.replace(/\?$/,"")+'",'+i+",function(o){return ");break;case"#":r=r.slice(1),i=1,a.push(r),q(r),S(r,c[r]),c[r]=i,n="o","."==r[0]&&(n="it",r=r.substring(1)),l.push("+"+b+"("+n+',"'+r+'",'+i+",function(it,i){return ");break;case"^":q(r=r.slice(1)),l.push("+o."+r+"+");break;default:if("?"==r.slice(-1))i=4,a.push(r),S(r,c[r]),c[r]=i,n="o","."==r[0]&&(n="it",r=r.substring(1)),l.push("+"+b+"("+n+',"'+r.slice(0,-1)+'",'+i+",function(o){return ");else if(r.match(/(.+)\((.*)\)/)){if(o=RegExp.$1,s=RegExp.$2,n="globals","."==o[0]&&(n="it",o=o.substring(1)),s=s.replace(/(^|,)\./g,"$1it.").replace(/it\.\s*,/g,"it,"),!("globals"!=n||g&&g[o]))throw new Error('unknown global "'+o+'"');s=s.split(",").map(function(e){return'"'==e[0]||"'"==e[0]||parseInt(e)==e||1==e||0==e||e.startsWith("it")?e:"o."+e.trim()}),l.push("+ "+n+"."+o+"("+s+")+")}else q(r),r="."==r||"it"==r?"it":r.startsWith("it.")?r:"."==r[0]?"it"+r:"i"==r?"i":"o."+r,l.push("+"+h+"("+r+")+")}return l="\n"+((u=g)?"var globals = {\n"+Object.keys(u).map(function(e){return"  "+e+": "+("function"==typeof u[e]?u[e].toString():JSON.stringify(u[e]))}).join(",\n")+"\n};\n\n":"")+j(x.toString())+";\n\n"+j(w.toString())+";\n\n"+j(v.toString())+";\n\n return "+l.join("").replace(/\r?\n/g,f),new Function("o",l)}function q(e){if(!e.match(/^[\w.\[\]\"\\']+$/))throw new Error('invalid property "'+e+'"')}function S(e,t){if(void 0!==t)throw new Error('cannot overwrite existing conditional for "'+e+'"')}function j(e){return e.replace(/^/gm,"  ")}return{render:function(e,t,n){t=t||{};var r=(n=n||{}).key&&i[n.key]||o(e,n);return n.key&&!i[n.key]&&(i[n.key]=r),r(t)},compile:o}}();"undefined"!=typeof module&&module.exports&&(exports=module.exports=qiq.render,exports.compile=qiq.compile);
