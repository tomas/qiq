var qiq=function(){var i={},v=/\{\{ ?| ?\}\}/;function k(t){return t.name||(t.toString().match(/function (.+?)\(/)||[,""])[1]}function w(t,e){var n=t,r=e.split(".");for(var i in r){if(!n[e=r[i]])return;n=n[e]}return n}function x(t,e,n,r){var i=t.constructor==Object&&-1<e.indexOf(".")?w(t,e):t[e];if(4==n)return!(x.last=i)||void 0!==i.length&&!i.length?"":r(t);if((2==n||3==n)&&x.last&&(!Array.isArray(x.last)||x.last.length))return x.last=null,"";if(Array.isArray(i))return n%3==0?i.length?"":r(t):1==n?i.map(r).join(""):r(i);if(1==n&&i&&i.constructor===Object)return r(i);if("function"==typeof i){if("boolean"!=typeof(i=i.call(t,r(t))))return i;i||2!==n||(i=!i)}return n%3==0&&(i=!i),(x.last=i)?r(t):""}function q(t){return String(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function o(t,e){e=e||{};for(var n,r,i,o,s,l,a=[],u={},c=[],f=t.split(e.delimiter||v),p=e.escapeNewLines?"\\\\\\n":"\\n",h=e.globals,g=k(q),m=k(x),d=0;d<f.length;++d)if(r=f[d],d%2==0)a.push('"'+r.replace(/"/g,'\\"')+'"');else switch(r[0]){case"/":r=r.slice(1);var y=c[c.length-1];if(""==r)r=y;else if(r!=y)continue;a.push("})+"),c.pop(),delete u[r];break;case"!":r=r.slice(1),i=0,c.push(r),"?"==r.slice(-1)&&(i=6,r=r.slice(0,-1)),S(r),j(u[r]),u[r]=i,a.push("+"+m+'(o,"'+r+'",'+i+",function(o){return ");break;case"#":if(r=r.slice(1),i=1,c.push(r),S(r),j(r,u[r]),u[r]=i,n="o",r.startsWith("it."))n=(b=r.split("."))[0],r=b[1];a.push("+"+m+"("+n+',"'+r+'",'+i+",function(it,i){return ");break;case"^":S(r=r.slice(1)),a.push("+o."+r+"+");break;case"_":if(""!=(r=r.slice(1))&&"else"!=r||(r=c[c.length-1]),i=u[r]+2,n="o",r.startsWith("it."))n=(b=r.split("."))[0],r=b[1];a.push("})+"+m+"("+n+',"'+r.replace(/\?$/,"")+'",'+i+",function(o){return ");break;default:if("?"==r.slice(-1)){if(i=4,c.push(r),j(r,u[r]),u[r]=i,n="o",r.startsWith("it."))n=(b=r.split("."))[0],r=b[1];a.push("+"+m+"("+n+',"'+r.slice(0,-1)+'",'+i+",function(o){return ")}else if(r.match(/(.+)\((.*)\)/)){var b;if(o=RegExp.$1,s=RegExp.$2,n="globals",-1<o.indexOf("."))n=(b=o.split("."))[0],o=b[1];if(!("globals"!=n||h&&h[o]))throw new Error('unknown global "'+o+'"');s=s.split(",").map(function(t){return'"'==t[0]||"'"==t[0]||parseInt(t)==t||1==t||0==t||t.startsWith("it.")||"it"==t?t:"this"==t?"o":"o."+t.trim()}),a.push("+ "+n+"."+o+"("+s+")+")}else S(r),r=r.startsWith("it.")||"it"==r?r:"this"==r?"o":"i"==r?"i":"o."+r,a.push("+"+g+"("+r+")+")}return a="\n"+((l=h)?"var globals = {\n"+Object.keys(l).map(function(t){return"  "+t+": "+("function"==typeof l[t]?l[t].toString():JSON.stringify(l[t]))}).join(",\n")+"\n};\n\n":"")+O(q.toString())+";\n\n"+O(x.toString())+";\n\n"+O(w.toString())+";\n\n return "+a.join("").replace(/\r?\n/g,p),new Function("o",a)}function S(t){if(!t.match(/^[\w.\[\]\"\\']+$/))throw new Error('invalid property "'+t+'"')}function j(t,e){if(void 0!==e)throw new Error('cannot overwrite existing conditional for "'+t+'"')}function O(t){return t.replace(/^/gm,"  ")}return{render:function(t,e,n){e=e||{};var r=(n=n||{}).key&&i[n.key]||o(t,n);return n.key&&!i[n.key]&&(i[n.key]=r),r(e)},compile:o}}();"undefined"!=typeof module&&module.exports&&(exports=module.exports=qiq.render,exports.compile=qiq.compile);
